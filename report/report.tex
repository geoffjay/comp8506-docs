%
% OpenDCS Proposal
%
% Author: Geoff Johnson
%
% To compile: pdflatex --shell-escape --synctex=1 --interaction=nonstopmode report.tex
%

\documentclass[11pt]{article}

\usepackage[titles]{tocloft}
\usepackage{verbatim}
\usepackage[pdftex]{graphics,graphicx}
\usepackage[export]{adjustbox}
\usepackage{booktabs}
\usepackage{pdfpages}
\usepackage{float}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{biblatex}
\usepackage{svg}
\usepackage{tikz}
\usepackage{listings,lstautogobble}
\usepackage[tablegrid]{vhistory}
\usetikzlibrary{arrows}
\bibliography{references}

\usepackage{hyperref}
\hypersetup{%
  pdfauthor={Geoff Johnson},
  pdftitle={OpenDCS Project Report},
  pdfsubject={Project Report},
  pdfkeywords={OpenDCS Project Report},
  colorlinks=true,
  linkcolor=black,
  urlcolor=blue
}

% Change listing setup.
\definecolor{sol-basic}{RGB}{101,123,131} % Base0
\definecolor{sol-comment}{RGB}{147,161,161} % Base1
\definecolor{sol-keyword}{RGB}{133,153,0} % Green
\definecolor{sol-string}{RGB}{203,75,22} % Orange
\definecolor{sol-emph}{RGB}{211,54,130} % Magenta
\definecolor{sol-background}{RGB}{253,246,227} % Base3

\lstset{
  language=xml,
  backgroundcolor=\color{sol-background},
  identifierstyle=\ttfamily,
  basicstyle=\footnotesize\ttfamily\color{sol-basic},
  keywordstyle=\color{sol-keyword},
  commentstyle=\color{sol-comment},
  stringstyle=\color{sol-string},
  emph={dcs,objects,object,property},
  emphstyle={\color{sol-emph}},
  tabsize=4,
  aboveskip={1.5\baselineskip},
  columns=fixed,
  inputencoding=utf8,
  extendedchars=true,
  breaklines=true,
  prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
  frame=single,
  showtabs=false,
  showspaces=false,
  showstringspaces=false,
  numbers=left,
  numberstyle=\tiny,
  breakatwhitespace=true,
  title=\lstname,
  literate={│}{{\textSFxi}}1 {└}{{\textSFii}}1 {├}{{\textSFviii}}1 {─}{{\textSFx}}1,
  autogobble=true,
}

% Packages used for appendices.
\usepackage{appendix}
\usepackage{listings}
\usepackage{color}
\definecolor{light-gray}{gray}{0.95}
\definecolor{listinggray}{gray}{0.9}
\definecolor{lbcolor}{rgb}{0.9,0.9,0.9}
\definecolor{light-blue}{rgb}{0.6,0.720,0.85}

% The default margins are too wide all the way around, reset them.
\setlength{\topmargin}{-.5in}
\setlength{\textheight}{9in}
\setlength{\oddsidemargin}{0in}
\setlength{\textwidth}{6.5in}

% Change paragraph formatting.
\setlength{\parindent}{0pt}
\setlength{\parskip}{2ex}

% Add paragraph as a section number
\setcounter{secnumdepth}{4}

\begin{document}
\nocite{*}

  \title{%
    OpenDCS $-$ An Open Distributed Control System\vspace{2em}
  }

  \author{%
    Geoff Johnson \vspace{0.5em} \\
    geoff.jay@gmail.com \vspace{0.5em} \\
    A00533481 \vspace{0.5em} \\
    COMP8045 \vspace{0.5em}
  }

  \maketitle
  \thispagestyle{empty}
  \newpage
  \mbox{}
  \thispagestyle{empty}

  \newpage
  \addtocounter{page}{-1}
  \pagenumbering{roman}
  \tableofcontents
  \listoffigures
  \listoftables
  \lstlistoflistings

  \newpage
  \pagenumbering{arabic}

  % XXX fill in or omit sections as needed, for now just blasting ideas

  \section{Project Description}\label{sec:desc}

    \subsection{Background}\label{sec:desc-bg}

      \subsubsection{Student}\label{sec:desc-bg-student}

        Geoff Johnson is a student of the BCIT Computer Systems Bachelor's degree.
        Prior to this he obtained a diploma of Computer Systems Technology from
        Camosun college in Victoria in 2001, as well as a diploma in Robotics and
        Automation Technology from BCIT in 2006.

        For the past 10 years Geoff has worked in Burnaby for the fluid mechanics
        research and development company Coanda where he is responsible for managing
        the IT operations, as well as managing and contributing to control system
        software development. This software is used to interface with industrial
        instrumentation, perform automated feedback control of plant processes,
        and capture data to log files at upwards of 100,000 samples per second.

      \subsubsection{Company}\label{sec:desc-bg-company}

        Coanda is an engineering research and development company specializing in
        industrial fluid dynamics and related technologies. They have been in
        business for close to 20 years providing services in process flow modelling,
        design optimization, and custom instrumentation to name a few. For more
        information their website is \url{https://www.coanda.ca}.

      \subsubsection{History}\label{sec:desc-bg-project}

        The project that was proposed, and is the subject of this report, was the
        reproduction of an existing piece of software used to measure and control
        physical processes. The software that this project seeks to improve upon
        is comprised of two software projects, a library of objects that abstract
        components of a data acquisition and control system, and a GUI application
        that functions as an operator panel.

        The first is a library of objects
        that abstracts the data acquisition hardware as various types of measurement
        channels, it handles logging to both CSV files as well as databases,
        feedback control loop calculations using the PID (Proportional
        Integral Derivative) equation, and handles the creation of object hierarchy
        through a class builder using XML as the input. This library, libcld, is an
        open source project hosted in a git repository at
        \url{https://github.com/geoffjay/libcld}.

        The second piece of software is a user facing GUI application developed for
        the GNOME system. It interfaces with libcld, hereafter referred to as
        CLD (Control, Logging, and Data Acquisition), using a single context to
        provide the data necessary to update the interface view. This application
        has also been released as open source and is hosted in a git repository
        at \url{https://github.com/coanda/dactl}.

    \subsection{Proposed Solution}\label{sec:desc-soln}

      Performing all of the work in a single application for data acquisition,
      feedback control, and data logging is open to a variety of issues. Doing so
      limits hardware scalability, places critical operations onto systems running
      desktop software, and ties high reliability functions like plant control in
      the same process as the front end that the end user operates. These are just
      a few of the more obvious problems.

      The system being proposed in this document is one that implements all of
      the hardware access and logging functionality as micro-services that run as
      processes detached from the plant operators that interact with the GUI
      application. This server software will use an existing library to interface
      with the data acquisition hardware as well as perform the control and
      logging tasks, this aspect of the software is a reimplementation of work
      that already exists in an application that is currently in use.

      New functionality that is planned is the definition and minimal
      implementation of a REST API, a messaging system for streaming data, and a
      configuration definition to allow for the reconfiguration of the daemon. The
      REST API is meant to provide a means for clients to make simple requests of
      the system like read a single measurement value or change a property value
      of one of the internal objects. ZeroMQ is to be used to implement the
      messaging system, it has several high level features including publish and
      subscribe socket types that can be used for a streaming data system, a
      request/reply structure for a higher performance version of the REST API,
      and a structure for bridging communications to allow for the reconfiguration
      of the server as a proxy or slave node in a distributed system.

  \section{Requirements}\label{sec:req}

    The stakeholders that have been identified from Coanda are:

    \begin{table}[H]
      \centering
      \begin{tabular}{l p{6cm} p{6cm}}
        \toprule
        Name & Organization Role & Project Role \\ [0.5ex]
        \midrule
        Geoff Johnson & Software Developer        & Project Lead \\
        Stephen Roy   & Software Developer        & Contributor \\
        Scott Webster & Research Scientist        & Requirements Contributor \\
        Thomas Depew  & Instrumentation Scientist & Requirements Contributor \\
        Bernie LeSage & Chief Operations Officer  & Project Reviewer \\
        \bottomrule
      \end{tabular}
      \caption{Project Stakeholders}\label{tab:stakeholders}
    \end{table}

    \subsection{Raw List from Project Stakeholders}\label{sec:req-sh}

      \begin{table}[H]
        \centering
        \begin{tabular}{l p{11cm} p{3cm}}
          \toprule
          Number & Description & Priority (1-5)\newline 1 is highest \\ [0.5ex]
          \midrule
          1 & Devices must be loaded as plugins & 1 \\
          \bottomrule
        \end{tabular}
        \caption{Initial Requirements List}\label{tab:requirements}
      \end{table}

    \subsection{Analysis}\label{sec:req-analyze}

    \subsection{System Requirements Specifications}\label{sec:req-srs}

      \subsubsection{Core Library}\label{sec:req-srs-core}

        \input{analysis/srs-libdcs-core}

      \subsubsection{Data Acquisition Library}\label{sec:req-srs-daq}

      \subsubsection{Data Logging Library}\label{sec:req-srs-log}

      \subsubsection{Process Control Library}\label{sec:req-srs-ctl}

      \subsubsection{Services/Networking Library}\label{sec:req-srs-net}

      \subsubsection{Device Plugins}\label{sec:req-srs-dev-plug}

      \subsubsection{Logging Plugins}\label{sec:req-srs-log-plug}

      \subsubsection{Control Plugins}\label{sec:req-srs-ctl-plug}

      \subsubsection{Data Acquisition Service}\label{sec:req-srs-daq}

      \subsubsection{Data Logging Service}\label{sec:req-srs-log}

      \subsubsection{Process Control Service}\label{sec:req-srs-control}

  \section{Design}\label{sec:dsg}

  \section{Modeling}\label{sec:mod}

    \subsection{Use Cases}\label{sec:mod-use}

      % good example of use case in "Bootstrap grids day 2" http://www.bossable.com/577/mean-stack-bootstrap/

  \section{Development}\label{sec:dev}

    \subsection{Autotools Build Systems}\label{sec:dev-ac}

    \subsection{REST APIs}\label{sec:rest}

      \subsubsection{Data Acquisition Service}\label{sec:rest-daq}

      \subsubsection{Data Logging Service}\label{sec:rest-log}

      \subsubsection{Process Control Service}\label{sec:rest-control}

  \section{Installation}\label{sec:inst}

    \subsection{Environment}\label{sec:inst-env}

      OpenDCS and it's constituent components have been designed to operate
      within an environment that is built of or provides the following:

      \begin{itemize}
        \item GNU/Linux
        \item Automake/Autoconf
        \item LAN connection
      \end{itemize}

    \subsection{Compilation}\label{sec:inst-comp}

      \begin{lstlisting}[caption={},label={}]
      \end{lstlisting}

    \subsection{Dependencies}\label{sec:inst-dep}

      The software dependencies that are required to be installed to fully
      compile all components of this project are:

      \begin{itemize}
      \end{itemize}

      \begin{lstlisting}[caption={},label={}]
      \end{lstlisting}

    \subsection{Containerized Components}\label{sec:inst-cont}

      \begin{lstlisting}[caption={},label={}]
      \end{lstlisting}

  \section{Configuration}\label{sec:cfg}

    For all OpenDCS objects that are the type \emph{Object} configuration can be
    represented for \emph{property} as data, \emph{id} and \emph{type} as
    attributes, and additionally \emph{property} should have a \emph{name}
    attribute. For all that are the type \emph{Container} will have as an
    addition an array of \emph{Object} nodes.

    \subsection{XML Format}\label{sec:cfg-xml}

      Object:

      \begin{lstlisting}[caption={Object Configuration in XML},label={lst:cfg-xml-obj}]
        <core:object id="ds0" type="data-series">
          <property name="buffer-size">100</property>
          <property name="stride">10</property>
        </core:object>
      \end{lstlisting}

      Container:

      \begin{lstlisting}[caption={Container Configuration in XML},label={lst:cfg-xml-ctr}]
        <core:object id="" type="">
          <property name=""></property>
          <core:object id="" type="" />
          <core:object id="" type="" />
        </core:object>
      \end{lstlisting}

      Nested Containers:

      \begin{lstlisting}[caption={Nested Container Configuration in XML},label={lst:cfg-xml-ctr}]
        <core:object id="" type="">
          <property name=""></property>
          <core:object id="" type="">
            <property name=""></property>
            <core:object id="" type="" />
            <core:object id="" type="" />
          </core:object>
        </core:object>
      \end{lstlisting}

    \subsection{JSON Format}\label{sec:cfg-json}

      Object:

      \begin{lstlisting}[caption={Object Configuration in JSON},label={lst:cfg-json-obj}]
        {
          "id": "ds0",
          "type": "data-series",
          "properties": [
            { "name": "buffer-size", "value": 100 },
            { "name": "stride", "value": 10 }
          ]
        }
      \end{lstlisting}

      Container:

      \begin{lstlisting}[caption={Container Configuration in JSON},label={lst:cfg-json-ctr}]
        {
          "id": "ctr0",
          "type": "container",
          "properties": [
            { "name": "sample", "value": "sample" }
          ],
          "objects": [
            { "id": "", "type": "" },
            { "id": "", "type": "" }
          ]
        }
      \end{lstlisting}

      Nested Containers:

      \begin{lstlisting}[caption={Nested Container Configuration in JSON},label={lst:cfg-json-ctr}]
        {
          "id": "ctr0",
          "type": "container",
          "properties": [
            { "name": "sample", "value": "sample" }
          ],
          "objects": [
            {
              "id": "samp0",
              "type": "sample",
              "properties": [
                { "name": "sample", "value": "sample" }
              ],
              "objects": [
                { "id": "", "type": "" },
                { "id": "", "type": "" }
              ]
            },
          ]
        }
      \end{lstlisting}

  \section{Testing}\label{sec:test}

    \subsection{Unit Tests}\label{sec:test-unit}

      Adding support to build and run unit tests can be done using the commands given here
      in Listing~\ref{lst:test-unit}.

      \begin{lstlisting}[caption={Compiling and Running Unit Tests},label={lst:test-unit}]
        ./autogen.sh --enable-tests
        make -j8
        make check
      \end{lstlisting}

      If everything completes successfully a test suite summary should be given similar to
      what is given here in Listing~\ref{lst:test-unit-summary}.

      \begin{lstlisting}[caption={Test Suite Summary},label={lst:test-unit-summary}]
        PASS: test-dcs-core
        ============================================================================
        Testsuite summary for dcs 0.2.0
        ============================================================================
        # TOTAL: 1
        # PASS:  1
        # SKIP:  0
        # XFAIL: 0
        # FAIL:  0
        # XPASS: 0
        # ERROR: 0
        ============================================================================
      \end{lstlisting}

    \subsection{Coverage Reports}\label{sec:test-cov}

      \begin{lstlisting}[caption={Generating Coverage Reports},label={lst:test-cov}]
        ./autogen.sh --enable-coverage --enable-tests
        make -j8
        make check
        make coverage
      \end{lstlisting}

      \begin{lstlisting}[caption={Coverage Summary},label={lst:test-cov-summary}]
        %Writing data to ../lcov.info
        %Summary coverage rate:
          %lines......: 55.6% (1167 of 2100 lines)
          %functions..: no data found
          %branches...: no data found
        %/usr/bin/mkdir -p ../tests/coverage
        %git_commit=`GIT_DIR=../.git git log -1 --pretty=format:%h 2>/dev/null`;\
        %genhtml --title "dcs 0.2.0 $git_commit" \
          %--output-directory ../tests/coverage ../lcov.info
        %Reading data file ../lcov.info
        %Found 50 entries.
        %Found common filename prefix "/home/gjohn/Dropbox/Projects/opendcs/dcs"
        %Writing .css and .png files.
        %Generating output.
        %Processing file src/libdcs-core/dcs-meta-factory.vala
        %... a bunch more lines like the last ...
        %Writing directory view page.
        %Overall coverage rate:
          %lines......: 55.6% (1167 of 2100 lines)
          %functions..: no data found

        %lcov report can be found in:
        %file:///home/gjohn/Dropbox/Projects/opendcs/dcs/tests/coverage/index.html

        %make[1]: Leaving directory '/home/gjohn/Dropbox/Projects/opendcs/dcs/tests'
      \end{lstlisting}

  \section{Results}\label{sec:res}

  % Insert a list of references that were cited.
  %\newpage
  %\printbibliography%

  % Appendices
  \newpage
  \addappheadtotoc%
  \appendix
  \appendixpage%

  % Left over from a previous proposal document, edit later as needed.
  \section{Glossary of Abbreviations and Terms}\label{app:glossary}

    Abbreviations and terms used within this document for computing and
    software related topics are given in Table~\ref{tab:gloss:sw}, and in
    Table~\ref{tab:gloss:hw} for hardware and data acquisition related topics.

    \begin{table}[H]
      \centering
      \begin{tabular}{l p{12cm}}
        \toprule
        Term & Definition/Explanation \\ [0.5ex]
        \midrule
        API & Application Programming interface \\
        Client & Refers to the software application that communications with a daemon \\
        Container & Operating system level virtualization similar to chroot jails \\
        CRC & Cyclic Redundancy Check, an error checking mechanism \\
        CRUD & Create, Read, Update, Delete \\
        Daemon & Common term used to refer to a server application in a Linux system \\
        DevOps & A practice emphasizing collaboration between developers and IT professionals \\
        Docker & Container software applications used for DevOps and SysOps \\
        GLib & Standard set of Linux system libraries for the GNOME window manager \\
        GNU & A collection of applications, libraries, and developer tools \\
        GNOME & Open source dekstop environment software used with Linux systems \\
        GObject & A C type library to gain object oriented style features \\
        GUI & Graphical User Interface \\
        OSS & Open Source Software \\
        Perl & A high level programming language good for rapid development \\
        REST & Representational State Transfer \\
        RS232 & Serial communication devices that has been ubiquitous for decades \\
        SDD & Software Specification Design Document \\
        SRS & Software Requirements Specification \\
        SysOps & System operator of a multi-user computing system \\
        UML & Unified Modeling Language \\
        Vala & An object oriented programming language that uses GObject types \\
        valadoc & A documentation standard and tool for creating API descriptions \\
        XML & Extensible markup language, common for use in messaging systems \\
        \bottomrule
      \end{tabular}
      \caption{Glossary of Software Terms}\label{tab:gloss:sw}
    \end{table}

    \begin{table}[H]
      \centering
      \begin{tabular}{l p{12cm}}
        \toprule
        Term & Definition/Explanation \\ [0.5ex]
        \midrule
        Comedi & Open source hardware drivers for Control and Measurement Devices \\
        Container & Operating system level virtualization similar to chroot jails \\
        Data Acquisition & The act of gathering data from a real world process \\
        DAQ & Acronym for Data Acquisition \\
        Plant & Term commonly used for industrial control systems \\
        Watchdog & Standard concept for monitoring a vital systems heartbeat \\
        \bottomrule
      \end{tabular}
      \caption{Glossary of Hardware Terms}\label{tab:gloss:hw}
    \end{table}

  \newpage

  \section{Websites Referenced}\label{app:websites}

    A list of websites that have been referenced in this document. These have
    been presented here instead of wherever the hyperlink has been made
    because in some cases very long URLs in printed documents can be less useful
    than an active link in a digital one.

    \begin{table}[H]
      \centering
      \begin{tabular}{l p{10cm}}
        \toprule
        Name & URL \\ [0.5ex]
        \midrule
        Coanda     & https://www.coanda.ca \\
        CRUD       & https://en.wikipedia.org/wiki/Create,\_read,\_update\_and\_delete \\
        dactl      & https://github.com/coanda/dactl \\
        libcld     & https://github.com/geoffjay/libcld \\
        Markdown   & https://en.wikipedia.org/wiki/Markdown \\
        Unit tests & https://github.com/geoffjay/libcld/tree/master/tests \\
        Valadoc    & http://valadoc.org \\
        \bottomrule
      \end{tabular}
      \caption{URL Reference List}\label{tab:websites}
    \end{table}

  \newpage

  \section{Sample Configurations}\label{app:configurations}

    Configuration files (XML and JSON) that will have been referenced throughout
    this document.

    \begin{lstlisting}[caption={Complete Core Sample},label={lst:full-core}]
      <?xml version="1.0"?>
      <dcs xmlns:core="libdcs-core">
        <property name="app">Sample</property>
        <core:objects>
          <core:object id="0" type="test"/>
        </core:objects>
      </dcs>
    \end{lstlisting}

    \begin{lstlisting}[caption={Complete DAQ Sample},label={lst:full-daq}]
      <?xml version="1.0"?>
      <dcs xmlns:core="urn:libdcs-core" xmlns:daq="urn:libdcs-daq">
        <property name="app">Sample</property>
        <core:objects>
          <core:object id="0" type="test"/>
        </core:objects>
      </dcs>
    \end{lstlisting}

    \begin{lstlisting}[caption={Complete Log Sample},label={lst:full-log}]
      <?xml version="1.0"?>
      <dcs xmlns:core="urn:libdcs-core" xmlns:log="urn:libdcs-log">
        <property name="app">Sample</property>
        <core:objects>
          <core:object id="0" type="test"/>
        </core:objects>
      </dcs>
    \end{lstlisting}

  \newpage

  \section{Document Change Log}\label{app:changelog}

    The table below serves to track the key revisions made to this document for
    change control purposes.

    \begin{versionhistory}
      \vhEntry{0.1}{2016-11-12}{Geoff Johnson}{Create initial report (pages: all)}
      \vhEntry{0.2}{2016-12-28}{Geoff Johnson}{Add configuration section (pages: 4-5)}
      \vhEntry{0.3}{2016-12-30}{Geoff Johnson}{Add appendices for glossary (pages: 6)}
      \vhEntry{0.4}{2017-01-04}{Geoff Johnson}{Add boilerplate for SRS (pages: 3-5)}
      \vhEntry{0.5}{2017-01-08}{Geoff Johnson}{Add project description (pages: 2)}
      %\vhEntry{}{}{}{}{}
      %\vhEntry{}{}{}{}{}
    \end{versionhistory}

\end{document}
